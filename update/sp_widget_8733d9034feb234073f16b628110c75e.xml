<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function(glideUserSession) {
  /* widget controller */
	
  var c = this;
	c.player = 1;
	glideUserSession.loadCurrentUser().then(function(currentUser) {
		c.player_name = currentUser.getFullName();
	//console.log(currentUser.getFullName());
	});
	//console.log('START',c.data);
	/*
	c.board_x = -12;
	c.board_y = 12;
	c.board = [];
	for(var y = 10; y >= -10; y--){
		for(var x=-10; x<=10; x++){
			var obj = {};
			obj.x = x;
			obj.y = y;
			c.board.push(obj);
		}
	}
	*/
	
	c.clickOnField = function(field){
		if (field.player != 0 || c.data.game.isOver) return;
		
		c.data.move = {};
		c.data.move.x = field.x;
		c.data.move.y = field.y;
		c.data.move.player = c.player;
		if (c.player == 1 ) c.player = 2; else c.player = 1;
		
		
		c.server.update();
		
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.field {
		   width : 25px;
		   height : 25px;
		   background-image: url('white.png');
		   float : left;
		}
h1,h3 {
	text-align : center;
}
h3 {
	color : red;
}
		.field.open:hover {
			background-color: grey;
		}
		.field.circle {
			background-image: url('circle.png');
		}
		.field.cross {
			background-image: url('cross.png');
		}
		.neighbour {
			background-color:lightgreen;
		}
		#board {
		   width : 525px;
		   height : 525px;
		   
		   margin : auto;
		float:left;
		margin-left : 250px;
		}
		#monitor {

		float:left;
		padding : 10px;
		
		}
		
		#save {
		width : 50px;
			background-color:red;
		color : white;
			margin : auto;
		padding : 10px;
		cursor: pointer
		}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>board</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>board</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	
		if (!input){
	
			var g = new GlideRecord('x_145082_cross_game');
			g.get('5656d35c4f3f630073f16b628110c7fe');
			data.game_sys_id = g.sys_id.toString();
			data.game = {}; 
			data.game.board = [];
			data.game.number = g.number.toString();
	    data.game.isOver = g.winner != 0;

			for(var y = 10; y >= -10; y--){
				for(var x=-10; x<=10; x++){
					var obj = {};
					obj.x = x;
					obj.y = y;

					var  p1 = '"player":"1","x":"'+x+'","y":"' + y +'"';
					var  p2 = '"player":"2","x":"'+x+'","y":"' + y +'"';
					if (g.game.indexOf(p1) > -1) obj.player = 1;
					else if (g.game.indexOf(p2) > -1) obj.player = 2;
					else obj.player = 0;

					data.game.board.push(obj);
				}
			}
		}
	else
	{
		//data.test2 = input.test;
		//data.move2 = input.move;
		//gs.info('test','test');
		//if (input.move.x > -100){
			//gs.info('test2 :' + input.game_sys_id,'test');
			var m = new GlideRecord('x_145082_cross_move');
			m.initialize();
			m.game = input.game_sys_id;
			m.x = input.move.x;
			m.y = input.move.y;
		  m.insert();
			var size = data.game.board.length;
		  for (var i=0;i<size;i++){
				if (data.game.board[i].x == input.move.x && data.game.board[i].y == input.move.y){
					data.game.board[i].player = input.move.player;
				}
					
				}
			}
			
		//}
	}
		
	
	
	
	
	
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-02-15 08:01:20</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>8733d9034feb234073f16b628110c75e</sys_id>
        <sys_mod_count>60</sys_mod_count>
        <sys_name>board</sys_name>
        <sys_package display_value="Cross game" source="x_145082_cross">feaf8d074fa7234073f16b628110c7b6</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Cross game">feaf8d074fa7234073f16b628110c7b6</sys_scope>
        <sys_update_name>sp_widget_8733d9034feb234073f16b628110c75e</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-02-21 15:00:41</sys_updated_on>
        <template><![CDATA[<div id = "board">
<!-- your widget template -->
  <h1>{{c.data.game.number}}</h1>
  <h3>{{c.player_name}} vs System</h3>
  
  <div class = "field" 
       ng-class="{ 'open': {{field.player == '0'}}, 'cross': {{field.player == '2'}}, 'circle': {{field.player == '1'}}}" 
       data-x="{{field.x}}" 
       data-y="{{field.y}}" 
       data-player="{{field.player}}"
       ng-repeat="field in c.data.game.board"
    	 ng-click="c.clickOnField(this.field)" >
  </div>
  
</div>]]></template>
    </sp_widget>
</record_update>
